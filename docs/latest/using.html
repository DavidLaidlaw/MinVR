<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>MinVR: Using MinVR in your project</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">MinVR
   &#160;<span id="projectnumber">0.9.0</span>
   </div>
   <div id="projectbrief">A multi-platform virtual reality library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Using <a class="el" href="namespaceMinVR.html">MinVR</a> in your project </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#using_appkit">Compiling and choosing an App Kit</a></li>
<li class="level1"><a href="#using_creating">Creating your application</a><ul><li class="level2"><a href="#using_creating_userinput">Overriding doUserInputAndPreDrawComputation</a></li>
<li class="level2"><a href="#using_creating_vars">Overriding initializeContextSpecificVars</a></li>
<li class="level2"><a href="#using_creating_draw">Overriding drawGraphics</a></li>
<li class="level2"><a href="#using_creating_main">Creating a main function</a></li>
<li class="level2"><a href="#using_creating_config">Using application configuration files</a></li>
</ul>
</li>
<li class="level1"><a href="#using_linking">Linking MinVR</a></li>
<li class="level1"><a href="#using_running">Running your application</a></li>
</ul>
</div>
<div class="textblock"><p>This guide will show you how to write your own simple virtual reality application using <a class="el" href="namespaceMinVR.html">MinVR</a>.</p>
<h1><a class="anchor" id="using_appkit"></a>
Compiling and choosing an App Kit</h1>
<p>While <a class="el" href="namespaceMinVR.html">MinVR</a> is designed to handle input device events and correct stereoscopic rendering projection matrices, frequently a more fully featured graphics toolkit is used to develop VR applications. <a class="el" href="namespaceMinVR.html">MinVR</a> has been designed to facilitate this by including AppKits for commonly used graphics libraries. To get started writing your application, choose a specific App Kit and compile it following the directions on <a class="el" href="compiling.html">Compiling MinVR</a>. If you are unsure of which AppKit to choose, we recommend the GLFW AppKit for creating windows for raw OpenGL use.</p>
<h1><a class="anchor" id="using_creating"></a>
Creating your application</h1>
<p>Once <a class="el" href="namespaceMinVR.html">MinVR</a> and the specific App Kit are compiled, you are ready to start writing your application. A <a class="el" href="namespaceMinVR.html">MinVR</a> program consists of two main classes: the AppKit specific MinVREngine, and an App class derived from <a class="el" href="AbstractMVRApp_8H.html">AbstractMVRApp.H</a>.</p>
<p>To create your App class, you will need to override the following methods:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> doUserInputAndPreDrawComputation(<span class="keyword">const</span> std::vector&lt;EventRef&gt; &amp;events, <span class="keywordtype">double</span> synchronizedTime) = 0;</div>
<div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> initializeContextSpecificVars(<span class="keywordtype">int</span> threadId, <a class="code" href="namespaceMinVR.html#a0989e54fbe549f52fa007de5bb58db5d">WindowRef</a> window) = 0;</div>
<div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> drawGraphics(<span class="keywordtype">int</span> threadId, <a class="code" href="namespaceMinVR.html#a509d30e59e3dfc69a4cbac9c027d74ca">AbstractCameraRef</a> camera, <a class="code" href="namespaceMinVR.html#a0989e54fbe549f52fa007de5bb58db5d">WindowRef</a> window) = 0;</div>
</div><!-- fragment --><p>We will start by discussing each method individually.</p>
<h2><a class="anchor" id="using_creating_userinput"></a>
Overriding doUserInputAndPreDrawComputation</h2>
<p>The <code>doUserInputAndPreDrawComputation</code> method is where you handle events generated from input devices, or the mouse and keyboard. See the <a class="el" href="events.html">Handling Events</a> for an example of how to respond to specific events.</p>
<h2><a class="anchor" id="using_creating_vars"></a>
Overriding initializeContextSpecificVars</h2>
<p>If your display configuration uses multiple windows, this method is particularly important. Each window runs its own render thread and has its own OpenGL context. This method is called individually by each thread when the application starts to initialize context specific OpenGL variables such as vertex buffer objects, textures, and shaders.</p>
<p>If you need to initialize App member variables in this method, we recommend that you declare the variables with <code>boost::thread_specific_ptr&lt;T&gt;</code> or c++11 thread local storage. For example, to do this with an id to reference a vertex buffer object you would declare the variable like this:</p>
<div class="fragment"><div class="line">boost::thread_specific_ptr&lt;GLuint&gt; _vboId;</div>
</div><!-- fragment --><p>Then in the <code>initializeContextSpecificVars</code> method you could initialize it like this:</p>
<div class="fragment"><div class="line">_vboId.reset(<span class="keyword">new</span> GLuint(0));</div>
<div class="line">glGenBuffersARB(1, _vboId.get());</div>
</div><!-- fragment --><p>Using a thread specific pointer object, enables you to run your application with a variety of different window configurations without worrying about explicitly creating a set number of variables that matches the number of windows (i.e. render threads). Under the hood, boost will create a new variable, and retrieve the correct thread specific one later if you reference it.</p>
<p>Alternatively, if you know you will only ever run your application with a specific number of windows, you could initialize your thread specific variables in an array. Then you could reference them using the threadId that is passed to the <code>drawGraphics</code> method as an index location in your array.</p>
<h2><a class="anchor" id="using_creating_draw"></a>
Overriding drawGraphics</h2>
<p>The <code>drawGraphics</code> method is where you should place your application's drawing code. Be aware that this method is called multiple times each frame when stereo rendering, and is also called by multiple threads if your application has multiple windows. Any member variables you reference here should be declared using boost's thread_specific_ptr as mentioned previously, or you should take care to make sure they are thread safe.</p>
<p>When this method is called by each render thread, the correct viewport and perspective matrices are already set. All you need to do is declare your rendering code. For example, to draw a triangle you might do something like this: </p>
<pre class="fragment">    camera-&gt;setObjectToWorldMatrix(glm::mat4(1.0));
    glBegin(GL_TRIANGLES);
    glColor3f(1.f, 0.f, 0.f);
    glVertex3f(-0.3f, -0.2f, -1.f);
    glColor3f(0.f, 1.0f, 0.f);
    glVertex3f(0.3f, -0.2f, -1.0f);
    glColor3f(0.f, 0.f, 1.f);
    glVertex3f(0.f, 0.3f, -1.f);
    glEnd();
</pre><p>Notice in the above example how to set the object to world matrix. The camera for the specific render thread context is passed as an argument to the method. A unique thread id for the calling thread is also passed. These ids start at zero and increment so that they can be used as array indices if needed.</p>
<h2><a class="anchor" id="using_creating_main"></a>
Creating a main function</h2>
<p>To run your application, you need a main function. This should initialize the <a class="el" href="namespaceMinVR.html">MinVR</a> App Kit engine, initialize your application, and call run. For example, your main might look like this:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="MVREngineGLFW_8H.html">AppKit_GLFW/MVREngineGLFW.H</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;GLFWDemoApp.H&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="DataFileUtils_8H.html">MVRCore/DataFileUtils.H</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line">        <span class="comment">// This is how you add a search path for MinVR to find setup files if they are stored in a</span></div>
<div class="line">        <span class="comment">// directory that differs from the MinVR install directory. Note that the $(G) will be replaced</span></div>
<div class="line">        <span class="comment">// by an environment variable called G.</span></div>
<div class="line">        <a class="code" href="classMinVR_1_1DataFileUtils.html#a3bc7bb0ee405b3036f9ebfffe59ef918" title="Adds the path to _dataFilePaths. The special sequence  gets replaced by the decygified value of the e...">MinVR::DataFileUtils::addFileSearchPath</a>(<span class="stringliteral">&quot;$(G)/src/MinVR/MVRCore/vrsetup&quot;</span>);</div>
<div class="line">        <a class="code" href="classMinVR_1_1DataFileUtils.html#a3bc7bb0ee405b3036f9ebfffe59ef918" title="Adds the path to _dataFilePaths. The special sequence  gets replaced by the decygified value of the e...">MinVR::DataFileUtils::addFileSearchPath</a>(<span class="stringliteral">&quot;$(G)/src/MinVR/MVRCore/shaders&quot;</span>);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="classMinVR_1_1AbstractMVREngine.html" title="Base class for vr engines. ">MinVR::AbstractMVREngine</a> *engine = <span class="keyword">new</span> <a class="code" href="classMinVR_1_1MVREngineGLFW.html" title="VR Engine for raw OpenGL apps based on GLFW. ">MinVR::MVREngineGLFW</a>();</div>
<div class="line">        engine-&gt;<a class="code" href="classMinVR_1_1AbstractMVREngine.html#ad8168356ad33bd8aa9c501f76488646e" title="Initialize the engine. ">init</a>(argc, argv);</div>
<div class="line">        <a class="code" href="namespaceMinVR.html#a370f070ef8c3e892f12bcdfaf1e2a642">MinVR::AbstractMVRAppRef</a> app(<span class="keyword">new</span> GLFWDemoApp());</div>
<div class="line">        engine-&gt;<a class="code" href="classMinVR_1_1AbstractMVREngine.html#a7c0a23d55ecabd1db41fc0efe105e481" title="Start the main loop. ">runApp</a>(app);</div>
<div class="line">        <span class="keyword">delete</span> engine;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="using_creating_config"></a>
Using application configuration files</h2>
<p>Configuration files are an easy way to access or change program settings without recompiling. The file contains text-based key=value pairs. At runtime, the value string can be easily reinterpreted by any class that overrides the stream &gt;&gt; and &lt;&lt; operators.</p>
<p>The structure of the configuration file is as follows: </p>
<pre class="fragment">    key value
</pre><p>where key has no spaces in it. value is everything after the space until the end of the line, so it can have spaces in it. Any line that <em>starts</em> with the character "#" is a comment and is ignored. A single "\" character means cut the line here and continue on the next line. Everything after the "\" is ignored and the text on the next line is appended to the text on the current line. You can escape the "\" operator with a "\\" to get a single "\" character.</p>
<p>Additionally, any value X appearing inside the special character sequence  will be replaced by the value of the environment variable named X. If X is not defined, it will be replaced by a null string. If X takes the form of the path to a file and you're running in Windows under cygwin then X will be automatically converted from the form /cygdrive/c/blah/blah to the more Windows friendly form c:/blah/blah to stay compatible with the Visual C++ compiler.</p>
<p>Additionally, if you put a += after the key and the key has already been defined, then the value is appended to the key's current value. If you don't have the += and the same key is read in from a file, then the new value overwrites the old. For example: </p>
<pre class="fragment">    mykey1     value1
    mykey1     value2
    mykey2     value3
    mykey2+=   value4
</pre><p>The value of mykey1 will be "value2". The value of mykey2 will be "value3 value4".</p>
<p>In your application, you can get the value of a key using the static method <code>ConfigVal(KEYTYPE keyString, const VALTYPE &amp;defaultVal, bool warn=true)</code>. The <code><a class="el" href="namespaceMinVR.html#acda74cf94461675b9d1f3504c8c7acb7">ConfigVal()</a></code> function figures out what type to try to convert the value to by the type of the second parameter to the function. This parameter also specifies the default value to return if the key is not found in the ConfigMap::_map Table.</p>
<p>Example: config-file.cfg </p>
<pre class="fragment">    MyLength  0.4
    MyVector (0.2, 0.4, 0.3)
</pre><p>In your application: </p>
<pre class="fragment">    double l  = ConfigVal("MyLength", 0.0);
    Vector3 v = ConfigVal("MyVector", glm::vec3(0.0));
</pre><p>To pass files to your application, use the <code>--configfile</code> or <code>-f</code> commandline parameters: </p>
<pre class="fragment">    $ myapp.exe desktop -f config-file.cfg
</pre><p>Alternatively, you can pass key value pairs directly using the <code>--configval</code> or <code>-c</code> parameters: </p>
<pre class="fragment">    $ myapp.exe desktop -c MyLength=0.4
</pre><h1><a class="anchor" id="using_linking"></a>
Linking MinVR</h1>
<p>The easiest way to link <a class="el" href="namespaceMinVR.html">MinVR</a> with your application is to use <a href="http://www.cmake.org">CMake</a>. If you have installed <a class="el" href="namespaceMinVR.html">MinVR</a>, a custom cmake find module called <code>MinVRConfig.cmake</code> was created during the install process. To link <a class="el" href="namespaceMinVR.html">MinVR</a>, you need to add the following lines to your <code>CMakeLists.txt</code> file, replacing AppKit_GLFW with whatever App Kit you are using: </p>
<pre class="fragment">    set(MinVR_DIR path/to/minvr/install/dir)
    find_package(MinVR COMPONENTS MVRCore AppKit_GLFW REQUIRED)
    include_directories(${MinVR_INCLUDE_DIRS})
    target_link_libraries(myProjectName ${MinVR_LIBRARIES})
</pre><h1><a class="anchor" id="using_running"></a>
Running your application</h1>
<p>To run your application, you must pass the name of a <a class="el" href="vrsetup.html">vrsetup file</a> as the first argument. Additional, configuration files can also be passed as arguments. For example, the following would run an app using the desktop configuration file and pass a configuration file called settings.cfg to the app. </p>
<pre class="fragment">    $ MyApp.exe desktop -f settings.cfg</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Sep 13 2013 13:56:18 for MinVR by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.4
</small></address>
</body>
</html>
